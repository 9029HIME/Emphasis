# 业务场景

博主拥有它的订阅粉丝，当博主发布一篇文章之后，需要将这篇文章推送给它的所有订阅粉丝，这时候可以怎么做呢？

# 推

![image](https://user-images.githubusercontent.com/48977889/192690965-bdd516e1-57a8-452d-b583-ce70891fd242.png)

为博主的每一位粉丝维护一条队列，博主一篇文章后，在后台处理完入库、持久化等数据操作后，将文章发到每个粉丝的队列里，在队列通过socket或者其他双向通道主动推送到粉丝客户端上。

# 拉

![image](https://user-images.githubusercontent.com/48977889/192691245-e61bba8d-0862-4c61-95ae-96b73238fc74.png)

粉丝客户端定时、主动向服务端拉取博主的文章，比如通过restful-api的方式不断地请求。

# 拉和推的问题

![image](https://user-images.githubusercontent.com/48977889/192692120-0abc703a-16cd-4cab-9065-f02dd3cd61f3.png)

什么是写扩散？假如博主有1000W个粉丝，当博主发了文章后，服务端需要将条消息推送给1000W个粉丝，对于服务端来说“出”的压力变大了。

对于写扩散来说，比较好的优化策略是，1.限制订阅粉丝数，控制粉丝队列的数量 2.优化存储策略，使用NoSQL进行存储 3.MQ异步写入，但会降低一部分实时性。

什么是读扩散？假如博主有500W个粉丝同时请求restful-api来获取消息，此时服务端承受着500W个并发请求，对于服务端来说“读”的压力变大了。

对于读扩散来说，比较好的优化策略是：1.增加时间间隔，减少轮询次数 2.服务端接口启动限流策略，降级提示“请稍后再访问” 3.增加缓存，减少数据查询时间。



**像推特这种软件，它采用了推拉两种策略的混合，当粉丝数＜阈值时，采用异步推的模式，由于数量较少，实时性比较高、写压力也比较少。当粉丝数＞阈值后，就采用拉的方式，通过缓存+限流策略，减少服务端的压力。**