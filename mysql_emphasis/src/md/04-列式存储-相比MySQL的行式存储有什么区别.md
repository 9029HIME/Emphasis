# 应用场景

相比与行式存储，列式存储更适合批量处理、超大规模的即使查询。列式存储的代表应用是HBASE和cassandra（这两个都在大数据场景下使用）

# 行式存储的物理过程

![image](https://user-images.githubusercontent.com/48977889/192529486-72a43a93-e81a-4c2a-92a2-3d6a8c92c573.png)

![image](https://user-images.githubusercontent.com/48977889/192529767-043eca3e-d605-46bf-9a7a-a86194919dd7.png)

比如要定位SELECT userName FROM 表 WHERE gender = '男'，通过行式存储来定位条件 和 定位结果需要磁盘大幅度的旋转，以满足磁头的寻址，时间都浪费在这了。对于固态硬盘来说，也是同理，因为数据之间也会因为行式存储，而离散地存放着。

# 列式存储的物理过程

至于列式存储，它的存储方式是这样的

![image](https://user-images.githubusercontent.com/48977889/192530448-991e38ce-c629-4788-8ca2-6a34be90459e.png)

基于这种连续的存储方式，能够提高寻址的效率。![image](https://user-images.githubusercontent.com/48977889/192531103-f8c9f251-dc6d-4354-951d-67af752f02ea.png)

# 列式存储的缺点

1. 因为列式存储的特性，它的写操作是非常低效的，需要在新增操作的同时保证存储的连续性，cassandra是通过列族的方式，将不同列存放到不同列族里。比如上面user表的四个字段，这四个字段分别用4个列族存储，当要新增数据的时候，只需往不同列族追加数据即可。比如

   1-2-3

   张三-李四-王五

   男-男-女

   20-23-21

   此时我要新增一个4-陈六-女-20，只需将值拆分出来，并发写入不同列族即可：

   1-2-3-4

   张三-李四-王五-陈六

   男-男-女-女

   20-23-21-20

2. 同理更新操作也很抵消，cassandra通过新增 + 版本号的方式，替代了更新操作，也就是说更新操作本质是一个写操作。

3. 删除也很麻烦，因为会更改列族结构，cassandra使用逻辑删除的方式避免。

4. 数据堆积问题，基本上列式存储的非读操作，都是不会减少数据的量，磁盘总会有满的时候，cassandra会定期清理过期数据，减少空间的使用。

5. 其实Hbase很多缺点的解决，都与cassandra类似，这里就不一一列举了。

# 总结

1. 列式存储更适合海量读，行式存储比较适合读写均匀的场景，因此列式存储更多使用在大数据项目中
2. 列式存储高效读的核心是：通过存储方式，减少了磁盘的寻址时间，使得数据能快速定位
3. 列式存储最大的缺点是非读操作的效率，当然，可以通过列族、版本号、逻辑删除的方案解决，同时要注意过期数据的清理。



